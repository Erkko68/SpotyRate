{% load duration_filters %}

<div class="flex mb-4 test-comment-container"
     vocab="http://schema.org/"
     typeof="Review"
     resource="#review-{{ rating.id }}">

    <!-- Item Being Reviewed (Dynamic Type) -->
    <div property="itemReviewed" typeof="MusicRecording">
        <meta property="name" content="Song">
        <link property="url" href="">

        {% if media.type == 'playlist' %}
            <meta property="numTracks" content="{{ media.tracks.total }}">
            <div property="creator" typeof="Person">
                <meta property="name" content="{{ media.owner.display_name }}">
            </div>
        {% elif media.type == 'album' %}
            <div property="byArtist" typeof="MusicGroup">
                {% for artist in media.artists %}
                <meta property="name" content="{{ artist.name }}">
                {% endfor %}
            </div>
            <meta property="datePublished" content="{{ media.release_date }}">
        {% else %}
            <div property="byArtist" typeof="MusicGroup">
                {% for artist in media.artists %}
                <meta property="name" content="{{ artist.name }}">
                {% endfor %}
            </div>
            {% if media.album %}
            <div property="inAlbum" typeof="MusicAlbum">
                <meta property="name" content="{{ media.album.name }}">
                <link property="url" href="{{ media.album.external_urls.spotify }}">
            </div>
            {% endif %}
            <meta property="duration" content="PT{{ media.duration_ms|format_iso_duration }}S">
        {% endif %}
    </div>

    <!-- Author Section -->
    <div property="author" typeof="Person" class="shrink-0 pr-4">
        <img src="{{ rating.user.profile_image_url|default:'https://via.placeholder.com/50/1DB954/FFFFFF?text=U' }}"
             alt="User avatar"
             class="w-12 h-12 rounded-full border-2 border-[var(--color-spotify-green)]"
             property="image">
        <meta property="name" content="{{ rating.user.display_name }}">
    </div>

    <!-- Review Content -->
    <div class="flex-1">
        <meta property="name" content="Review of {{ media.name }} by {{ rating.user.display_name }}">

        <div class="flex flex-wrap items-center gap-3 mb-2">
            <h3 class="font-semibold text-white" property="name">{{ rating.user.display_name }}</h3>

            <div property="reviewRating" typeof="Rating"
                 class="flex items-center gap-1 text-[var(--color-spotify-green)]">
                <meta property="ratingValue" content="{{ rating.stars }}">
                <meta property="bestRating" content="5">
                <meta property="worstRating" content="1">

                {% for i in "12345" %}
                    <span class="text-lg {% if forloop.counter <= rating.stars %}text-[var(--color-spotify-green)]{% else %}text-gray-400{% endif %}">
                        â˜…
                    </span>
                {% endfor %}
            </div>

            <span class="text-sm text-gray-400 ml-auto">
                <time property="datePublished" datetime="{{ rating.created_at|date:'c' }}">
                    {{ rating.created_at|timesince }} ago
                </time>
            </span>
        </div>

        <p class="text-gray-300" property="reviewBody">{{ rating.comment }}</p>

        {% if rating.updated_at != rating.created_at %}
        <meta property="dateModified" content="{{ rating.updated_at|date:'c' }}">
        {% endif %}
    </div>
</div>